---
title: "Dragon element data analysis"
author: "Stephanie J. Spielman and Naman Srivastava"
output: 
  html_document:
    theme: united
    highlight: pygments
    toc: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
library(tidyverse)
library(dragon)
#library(ggrepel)
library(broom)
library(performance)
library(ggtext)

theme_set(theme_classic() + theme(plot.subtitle = element_markdown()))

source("utils.R")
dragon:::element_info %>%
  # Not present since 4.33 Ga
  filter(element != "Tc") -> elements
```



First, we create a dataset containing element network information joined with other attributes of elements. We specifically _only consider elements that are known to form at least five minerals on Earth since 4.33 Ga._ The following elements are therefore excluded (in parentheses is given the number of minerals it forms): Dy (1), Er (1), Gd (1), Hf (1), Sm (1), Re (2), Rb (3). 

```{r build_all_networks}
mineral_threshold <- 5

purrr::map_df(elements$element, parse_element_network) %>%
  left_join(elements) %>%
  mutate(n_elements = as.numeric(n_elements),
         n_minerals = as.numeric(n_minerals),
         n_localities = as.numeric(n_localities)) %>%
  filter(n_minerals >= mineral_threshold) -> element_networks_info

element_networks_info
```

### Analysis 1: What is the relationship between number of elements interacted with and number of minerals formed?


<br>
First, we explore whether we should likely transform an axis on a log-scale. Model diagnostics are shown below for the model with _log y and untransformed x_, whose diagnostics best meet assumptions.
<br>

```{r model1_diagnose, fig.height=8, fig.width=8}
# regression

# No
#lm(n_minerals ~ n_elements, data = element_networks_info) -> model_plain
#performance::check_model(model_plain)

# Yes
lm(log(n_minerals) ~ n_elements, data = element_networks_info) -> model_ylog
performance::check_model(model_ylog)

# No
#lm(n_minerals ~ log(n_elements), data = element_networks_info) -> model_xlog
#performance::check_model(model_xlog)

# No
#lm(log(n_minerals) ~ log(n_elements), data = element_networks_info) -> model_xlog_ylog
#performance::check_model(model_xlog_ylog)
```


<br><br>

**The resulting model is as follows - _THERE IS A POSITIVE RELATIONSHIP._**


```{r model1_plot, fig.height=4, fig.width=6}

get_model_info(model_ylog, "n_elements") -> model_info

element_networks_info %>%
  mutate(n_minerals_log = log(n_minerals)) %>%
  ggplot() +
  aes(y = n_minerals_log,
      x = n_elements) +
  geom_point() +
  labs(x = "Number of Elements",
       y = "Log Number of Minerals", 
       subtitle = model_info) +
  geom_smooth(method = "lm") 
```




### Analysis 2: What is the relationship between number of elements interacted with and number of localities it is found at?


<br>
First, we explore whether we should likely transform an axis on a log-scale. Model diagnostics are shown below for the model with _log y and untransformed x_, whose diagnostics best meet assumptions.
<br>

```{r model2_diagnose, fig.height=8, fig.width=8}
# regression

# No
#lm(n_localities ~ n_elements, data = element_networks_info) -> model_plain
#performance::check_model(model_plain)

# Yes
lm(log(n_localities) ~ n_elements, data = element_networks_info) -> model_ylog
performance::check_model(model_ylog)

# No
#lm(n_localities ~ log(n_elements), data = element_networks_info) -> model_xlog
#performance::check_model(model_xlog)

# No
#lm(log(n_localities) ~ log(n_elements), data = element_networks_info) -> model_xlog_ylog
#performance::check_model(model_xlog_ylog)
```


<br><br>

**The resulting model is as follows - _THERE IS A POSITIVE RELATIONSHIP._**

```{r model2_plot, fig.height=4, fig.width=6}

get_model_info(model_ylog, "n_elements") -> model_info

element_networks_info %>%
  mutate(n_localities_log = log(n_localities)) %>%
  ggplot() +
  aes(y = n_localities_log,
      x = n_elements) +
  geom_point() +
  labs(x = "Number of Elements",
       y = "Log Number of Localities", 
       subtitle = model_info) +
  geom_smooth(method = "lm") 
```




### Analysis 3: What is the relationship between number of elements interacted with and percentage of crust?

> Note that there are six elements which do not appear in this analysis because they are missing crust data - C, H, N, REE (rare earth elements), Rh, Te.

<br>

First, we explore whether we should likely transform an axis on a log-scale. Model diagnostics are shown below for the model with _log y and untransformed x_, whose diagnostics best meet assumptions.

<br>

```{r model3_diagnose, fig.height=8, fig.width=8}
# regression

# No
#lm(element_crust_percent_weight ~ n_elements, data = element_networks_info) -> model_plain
#performance::check_model(model_plain)

# Yes
lm(log(element_crust_percent_weight) ~ n_elements, data = element_networks_info) -> model_ylog
performance::check_model(model_ylog)

# No
#lm(element_crust_percent_weight ~ log(n_elements), data = element_networks_info) -> model_xlog
#performance::check_model(model_xlog)

# No
#lm(log(element_crust_percent_weight) ~ log(n_elements), data = element_networks_info) -> model_xlog_ylog
#performance::check_model(model_xlog_ylog)
```




<br><br>

**The resulting model is as follows - _THERE IS A POSITIVE RELATIONSHIP._**

```{r model3_plot, fig.height=4, fig.width=6}

get_model_info(model_ylog, "n_elements") -> model_info

element_networks_info %>%
  mutate(element_crust_percent_weight_log = log(element_crust_percent_weight)) %>%
  ggplot() +
  aes(y = element_crust_percent_weight_log,
      x = n_elements) +
  geom_point() +
  labs(x = "Number of Elements",
       y = "Log crust percentage", 
       subtitle = model_info) +
  geom_smooth(method = "lm") 
```



### Analysis 4: What is the relationship between number of elements interacted with and electronegativity?


<br>

First, we explore whether we should likely transform an axis on a log-scale. Model diagnostics are shown below for the model with _both untransformed y and x_, whose diagnostics best meet assumptions.

<br>

```{r model4_diagnose, fig.height=8, fig.width=8}
# Yes
lm(pauling ~ n_elements, data = element_networks_info) -> model_plain
performance::check_model(model_plain)

# No
#lm(log(pauling) ~ n_elements, data = element_networks_info) -> model_ylog
#performance::check_model(model_ylog)

# No
#lm(pauling ~ log(n_elements), data = element_networks_info) -> model_xlog
#performance::check_model(model_xlog)

# No
#lm(log(pauling) ~ log(n_elements), data = element_networks_info) -> model_xlog_ylog
#performance::check_model(model_xlog_ylog)
```





<br><br>

**The resulting model is as follows - _THERE IS NO RELATIONSHIP._:**

```{r model4_plot, fig.height=4, fig.width=6}

get_model_info(model_plain, "n_elements") -> model_info

element_networks_info %>%
  ggplot() +
  aes(y = pauling,
      x = n_elements) +
  geom_point() +
  labs(x = "Number of Elements",
       y = "Pauling electronegativity", 
       subtitle = model_info) +
  geom_smooth(method = "lm") 
```






### Analysis 5: What is the relationship between number of minerals formed and electronegativity?


<br>

First, we explore whether we should likely transform an axis on a log-scale. Model diagnostics are shown below for the model with _log y and untransformed x_, whose diagnostics best meet assumptions.

<br>

```{r model5_diagnose, fig.height=8, fig.width=8}

# No
#lm(n_minerals ~ pauling, data = element_networks_info) -> model_plain
#performance::check_model(model_plain)

# Yes
lm(log(n_minerals) ~ pauling, data = element_networks_info) -> model_ylog
performance::check_model(model_ylog)

# No
#lm(n_minerals ~ log(pauling), data = element_networks_info) -> model_xlog
#performance::check_model(model_xlog)

# No but close
#lm(log(pauling) ~ log(n_minerals), data = element_networks_info) -> model_xlog_ylog
#performance::check_model(model_xlog_ylog)
```


<br><br>

**The resulting model is as follows - _THERE IS NO RELATIONSHIP._**

```{r model5_plot, fig.height=4, fig.width=6}

get_model_info(model_ylog, "pauling") -> model_info

element_networks_info %>%
  mutate(n_minerals_log = log(n_minerals)) %>%
  ggplot() +
  aes(y = n_minerals_log,
      x = pauling) +
  geom_point() +
  labs(x = "Pauling electronegativity",
       y = "Log number of minerals formed", 
       subtitle = model_info) +
  geom_smooth(method = "lm") 
```